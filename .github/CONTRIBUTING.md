## 開発 Flow

GitHub Flow を用いて開発を進める

1. `main` ブランチは常に安定(デプロイ可能)
2. `feature/○○` ブランチを作成して作業
3. 実装後 PR(Pull Request) を作成
4. 他のメンバーがレビュー・Approve
5. 実装者が通常マージ(Merge Commit)
6. 対応する Issue を Close、projects のカンバンを更新

## Issues

使用する issues テンプレートの設定ファイル

```yaml
#config.yaml
blank_issues_enabled: false
contact_links:
  - name: 質問・相談
    url: https://github.com/habitat-hub/board-game-prototype/discussions
    about: バグ報告や機能リクエスト以外の質問・相談はDiscussionsをご利用ください。

# Issue作成時のテンプレート設定
defaults:
  - template: 'bug_report.yml'
    name: '🐛 バグ報告'
    about: 'バグを報告する'
    labels: ['bug']

  - template: 'feature_request.yml'
    name: '💡 機能リクエスト'
    about: '新機能のアイデアを提案する'
    labels: ['feature']

  - template: 'documentation.yml'
    name: '✍️ ドキュメント改善'
    about: 'READMEやガイドなどの文書の改善提案'
    labels: ['documentation']

  - template: 'test_request.yml'
    name: '🧪 テスト改善'
    about: 'テストコードの改善や新しいテストケースの提案'
    labels: ['test']

  - template: 'ci_cd.yml'
    name: '📦 インフラ・CI/CD改善'
    about: 'Docker、GitHub Actions、AWSなどのCI/CD・インフラに関する提案を記入してください'
    labels: ['ci/cd']
```

`.github/ISSUE_TEMPLATE` に保存し、Issues を統一化する

| 種類                         | ファイル名            |
| ---------------------------- | --------------------- |
| バグ修正                     | `bug_report.yml`      |
| CI/CD                        | `ci_cd.yml `          |
| ドキュメント関連の追加・修正 | `documentation.yml`   |
| 機能追加・修正               | `feature_request.yml` |
| テストの追加                 | `test_request.yml`    |

## ブランチ・コミット・PR のルール

### ブランチ名(英語)

| 種類             | プレフィックス | 例                     |
| ---------------- | -------------- | ---------------------- |
| 機能追加         | `feature/`     | `feature/post-form`    |
| バグ修正         | `fix/`         | `fix/header-display`   |
| リファクタ       | `refactor/`    | `refactor/user-model`  |
| ドキュメント     | `docs/`        | `docs/README-update`   |
| CI/CD 関連       | `chore/`       | `chore/github-actions` |
| テスト追加・修正 | `test/`        | `test/user-model-spec` |
| スタイル変更     | `style/`       | `style/indent-fix`     |
| 開発用設定       | `config/`      | `config/linter-update` |

### コミットメッセージ(日本語)

- 一文で変更内容を表現すること : 例 `投稿フォームの作成`
- 複数コミット時には目的別に分割
- 補足があれば本文に記載(何を、なぜ、どうしたいか)

### Pull Request

使用するテンプレート

```
## ISSUE
close #ISSUE_NUMBER

## 実装概要
<!-- この PR の目的・背景を 1～2 行で記載してください（例：バグ修正、UI改善、パフォーマンス向上など） -->

## スクリーンショット
<!-- 変更前後のスクリーンショットやGIFを貼ってください。なければ省略可能です -->


## 動作確認手順
<!-- レビュアーが確認しやすいように、操作手順を具体的に記載してください -->
1.
2.
3.

## 影響範囲
<!-- この変更が影響する画面・機能・ファイルなどを記載してください（例：todo一覧画面、Userモデルなど） -->
-


## レビューポイント
<!-- レビュアーに特に見てほしい点があればチェックを入れてください -->
- [ ] **機能**：仕様どおりに動作するか
- [ ] **コード品質**：可読性・保守性
- [ ] **セキュリティ**：権限・バリデーション・入力チェック
- [ ] **パフォーマンス**：処理速度やリソース使用量
- [ ] **CI**：GitHub Actions のワークフローが成功しているか

## デプロイ／運用
<!-- 該当する項目にチェックを入れて、必要に応じて補足してください -->
- **マイグレーション**：有／無（テーブル追加、カラム変更など）
- **環境変数の追加**：有／無（.envやGitHub Secrets等）
- **破壊的変更の有無**：有／無（既存データへの影響など）


## チェックリスト（作成者用）
<!-- PR作成前に確認した内容にチェックを入れてください -->
- [ ] 自身で動作確認・コードレビューを完了した
- [ ] 不要なコメント・デバッグコードを削除した
- [ ] コミットメッセージがわかりやすく記述されている
- [ ] 関連Issueがリンクされている（あれば）

## チェックリスト（レビュアー用）
- [ ] 命名が一貫性をもち、一貫性があるか
- [ ] 処理が重複していないか
- [ ] コントローラーが肥大化していないか
- [ ] テストがあり、目的をカバーしているか
- [ ] UXや画面に不自然さがないか

```

上記テンプレートを `.github/PULL_REQUEST_TEMPLATE.md`に保存し、すべての PR で統一的に使用します

### PR 運用ルール

| 項目         | 内容                                                      |
| ------------ | --------------------------------------------------------- |
| タイトル     | 日本語で明確に記述: `投稿機能の作成(フォーム + 保存処理)` |
| コメント対応 | 全コメントにアクション or 返信で反応する                  |
| マージ方法   | **Approve 後、実装者が Merge Commit でマージ**            |

## Lint とテストの実装ルール

### バックエンド

**Lint: Rubocop**

- `.rubocop.yml`をプロジェクトに含める
- `rubocop -A`で自動成形
- GitHub Action による自動チェック(CI)

**RSpec: テストコード**

- モデル/リクエスト/システムテストを適切に実装
- PR には対応するテストを含めるのが原則
- Ci で bundle exec rspec がパスしていることを確認

## テスト観点

| 観点             | チェック内容                                             | 推奨テスト技法（例）                             |
| ---------------- | -------------------------------------------------------- | ------------------------------------------------ |
| **入力値**       | 必須／最大文字数／形式制限が機能しているか               | 同値クラステスト、境界値分析                     |
| **正常系**       | 正しい入力で正しく登録されるか                           | ハッピーシナリオ + 境界値分析                    |
| **異常系**       | 空欄・不正値でエラーが出るか                             | 同値クラステスト、境界値分析、ペアワイズ         |
| **表示内容**     | 一覧・詳細で登録内容が正しく表示されるか                 | スナップショットテスト（React）、CRUD シナリオ   |
| **リンク/遷移**  | 画面遷移が意図どおりか                                   | 状態遷移テスト、ペアワイズ                       |
| **権限**         | 未ログイン時のアクセス制限など                           | ロール別テスト、状態遷移テスト                   |
| **業務ルール**   | 入力条件の組み合わせで計算・結果が正しいか               | **ディシジョンテーブルテスト**                   |
| **複雑ドメイン** | 金額計算・日付ロジック・税率など複雑ドメインの境界を網羅 | **ドメイン分析テスト**（ドメインモデルに基づく） |

### 具体的な使い分けのイメージ

| 技法                         | 適用タイミング                                             |
| ---------------------------- | ---------------------------------------------------------- |
| **等価クラステスト**         | 入力欄の「許可／不許可」パターンを整理するとき             |
| **境界値分析**               | 文字数や数値の最小・最大ギリギリを確認するとき             |
| **ディシジョンテーブル**     | 複数の入力条件が絡むビジネスルール（割引率、権限フラグ等） |
| **ドメイン分析テスト**       | 金額＋税率＋端数処理＋日付範囲など“計算系”が多い画面       |
| **状態遷移テスト**           | ログイン状態・編集状態など UI がステートを持つ場合         |
| **ペアワイズ（組合せ削減）** | 入力項目が多く全組合せが現実的でないとき                   |

### 進め方のコツ

1. 観点 → 技法 → テストケース の順で落とし込み、ケースが多すぎる場合は ペアワイズ で削減します。

2. 業務ルール表 や ユースケース図 があるなら、ディシジョンテーブルを早めに作ると漏れが激減します。

3. React で状態管理が複雑（例: Wizard 形式フォーム）の場合は、状態遷移図を描いてそこからテストを導出すると早いです。

4. ドメイン分析テストは「計算系」「期間・日付ロジック系」で特に効果的なので、Rails 側 Model かバックエンド API レイヤで厚めに書くと安心です。

## カバレッジ

### バックエンド（Rails / RSpec）

**対象範囲:**

- モデルバリデーション
- コントローラ・API の正常/異常系
- 業務ロジック（サービスクラスやジョブなど）

**目標カバレッジ率**
80~90%程度を目標にする
